# 证书颁发

# 涉及到需要填写名称都要按照题目要求填写

# 1、生成根证书

## 1、安装证书组件

 yum install -y openssl-perl.x86_64

![image-20250610193344355](https://cdn.jsdelivr.net/gh/xyt250/image/img/image-20250610193344355.png)

## 2、安装完成后切换到CA目录下

cd /etc/pki/CA/

## 3、创建两个文件

![image-20250610193645518](https://cdn.jsdelivr.net/gh/xyt250/image/img/image-20250610193645518.png)

## 4、生成根证书私钥

openssl genrsa -out ca.key 2048

![image-20250610193755972](https://cdn.jsdelivr.net/gh/xyt250/image/img/image-20250610193755972.png)

## 5、创建申请文件

openssl req -new -out ca.csr -key ca.key

**国家**

**省**

**市**

**组织**

**组织单位**

**公用名**

**邮箱**

**密码**

**名称**

![image-20250610194024529](https://cdn.jsdelivr.net/gh/xyt250/image/img/image-20250610194024529.png)

![image-20250610194308391](https://cdn.jsdelivr.net/gh/xyt250/image/img/image-20250610194308391.png)

输入完公用名之后没有特殊要求就可以一直回车直到创建完成了

## 6、生成根CA的证书

 openssl x509 -req -days 3650 -in ca.csr -signkey ca.key -out ca.crt

![image-20250610194611075](https://cdn.jsdelivr.net/gh/xyt250/image/img/image-20250610194611075.png)

**-out 后为证书的文件名** 

**crt 是证书格式 csr 是申请文件的格式 key 是一个私钥**

## 7、编辑证书颁发规则

**编辑配置文件 openssl.cnf**

vim /etc/pki/tls/openssl.cnf

### 176 行

修改前：

![image-20250610195022697](https://cdn.jsdelivr.net/gh/xyt250/image/img/image-20250610195022697.png)

将 req_extensions 前的注释取消掉

修改后：

![image-20250610195156971](https://cdn.jsdelivr.net/gh/xyt250/image/img/image-20250610195156971.png)

### 222 行

修改前：

![image-20250610195248465](https://cdn.jsdelivr.net/gh/xyt250/image/img/image-20250610195248465.png)

将CA后面的后缀改为TRUE (让本机作为CA的认证中心)

修改后：

![image-20250610195423317](https://cdn.jsdelivr.net/gh/xyt250/image/img/image-20250610195423317.png)

### 244 行

修改前：

![image-20250610195506613](https://cdn.jsdelivr.net/gh/xyt250/image/img/image-20250610195506613.png)

在下面添加一行245行内容为

subjectAltName = @alt_names

修改后：

![image-20250610195704046](https://cdn.jsdelivr.net/gh/xyt250/image/img/image-20250610195704046.png)

### 248 行

修改前：

![image-20250610195747502](https://cdn.jsdelivr.net/gh/xyt250/image/img/image-20250610195747502.png)

将CA的后缀改为TRUE

修改后：

![image-20250610195826623](https://cdn.jsdelivr.net/gh/xyt250/image/img/image-20250610195826623.png)

### 249 行

修改前：

![image-20250610195943347](https://cdn.jsdelivr.net/gh/xyt250/image/img/image-20250610195943347.png)

在249行添加250行	

[alt_names]

后面添加使用者可选名称=

例如

DNS.1=*.skills.com  DNS.2=skills.com 最后回车

![image-20250610200326455](https://cdn.jsdelivr.net/gh/xyt250/image/img/image-20250610200326455.png)

保存并退出

# 2、申请SSL证书

## 1、创建私钥

openssl genrsa -out skills.key 2048

## 2、创建请求文件

**签发含有规则的配置文件**

openssl req -new -key skills.key -out skills.csr -config  /etc/pki/tls/openssl.cnf -extensions v3_req

![image-20250610201027737](https://cdn.jsdelivr.net/gh/xyt250/image/img/image-20250610201027737.png)

## 3、签发请求文件CSR

 openssl ca -in skills.csr -out skills.crt -cert ca.crt -keyfile ca.key -extensions v3_req -days 1825 -config /etc/pki/tls/openssl.cnf

![image-20250610201315094](https://cdn.jsdelivr.net/gh/xyt250/image/img/image-20250610201315094.png)
# 系统安装

## 1、安装PC1 系统为 ubuntu-desktop-amd64 系统

1、登录用户设置为 **xiao** 密码为 **Key-1122**

2、安装remmina

3、安装q e m u、l i b v i r t和v i r t -i n s tall

yum install qemu-kvm virt-install libvirt

## 2、安装 kylin-desktop-arm64（安装语言为英文）

1、安装时创建用户为 **xiao** 密码为 **Key-1122**  设置根用户密码为 **Key-1122**

# windows 云服务配置

## 1、创建实例

### 1、创建网络

![image-20250626193453468](https://cdn.jsdelivr.net/gh/xyt250/image/img/image-20250626193453468.png)

![image-20250626193624961](https://cdn.jsdelivr.net/gh/xyt250/image/img/image-20250626193624961.png)

![image-20250626193712701](https://cdn.jsdelivr.net/gh/xyt250/image/img/image-20250626193712701.png)



网络名称：Net10  vlan :10  子网名称：Sub10  网关：10.10.10.1/24 IPv4地址池：10.10.10.100,10.10.10.199

​				   Net20 			20					Sub20			  10.10.20.1/24						10.10.20.100,10.10.20.199

​				   Net50			 50                    Sub50              10.10.50.1/24                        10.10.50.100,10.10.50.199        

![image-20250626194810241](https://cdn.jsdelivr.net/gh/xyt250/image/img/image-20250626194810241.png)

###   2、创建实例类型

![image-20250626162529112](https://cdn.jsdelivr.net/gh/xyt250/image/img/image-20250626162529112.png)

名称：Skills  id：1 vcpu：4 内存：4096MB 磁盘：100G （删除所有实例类型）

![image-20250626162541251](https://cdn.jsdelivr.net/gh/xyt250/image/img/image-20250626162541251.png)

3、创建实例 

输入名称 windows1 选择正确的镜像 ，刚刚创建的实例类型和刚刚创建的网路。实例创建完成

![image-20250626162732263](https://cdn.jsdelivr.net/gh/xyt250/image/img/image-20250626162732263.png)



实例名称：windows1   镜像：windows2022  实例类型：Skills  IPv4地址：10.10.10.101    主机名称：windows1

​	               windows2			   windows2022                     Skills                     10.10.10.102      				windows2

​				   windows3			   windows2022			         Skills 	                10.10.10.103 					 windows3

​				   windows4               windows2022                     Skills                    **10.10.20.101**

​                                                                                                                               **10.10.50.101**  				     windows4

​	               windows5               windows2022                     Skills                    **10.10.20.102**

​																															   **10.10.50.102**		   		    windows5

![image-20250626194902648](https://cdn.jsdelivr.net/gh/xyt250/image/img/image-20250626194902648.png)

## 2、域服务

实例创建完成之后，先将windows1的主机名称改为windows1。

在windows1中 点击设置 、点击系统、拉到最下面的关于  重命名这台电脑 名称为windows1

![image-20250626155351481](https://cdn.jsdelivr.net/gh/xyt250/image/img/image-20250626155351481.png)

win+R 出现运行 ，输入ncpa.cpl 打开网路连接

![image-20250626155654356](https://cdn.jsdelivr.net/gh/xyt250/image/img/image-20250626155654356.png)

将IP地址改为静态，将DNS指向本机

![image-20250626195426736](https://cdn.jsdelivr.net/gh/xyt250/image/img/image-20250626195426736.png)

### 1、安装DNS服务

在服务器管理器中

点击添加角色和功能

前三项默认即可，来到第四项找到DNS服务进行安装

没有将IP地址修改为静态的情况下会变成这样

![image-20250626195546974](https://cdn.jsdelivr.net/gh/xyt250/image/img/image-20250626195546974.png)

这样是错误的

下面开始安装

![image-20250626200136811](https://cdn.jsdelivr.net/gh/xyt250/image/img/image-20250626200136811.png)

### 2、安装AD域服务

在安装列表中找到域服务并安装

![image-20250626200810139](https://cdn.jsdelivr.net/gh/xyt250/image/img/image-20250626200810139.png)

安装完成后  ，点击中间的小字 **将此服务器提升为域控制器**

点击添加新林 输入 题目中的要求

![image-20250626201333202](https://cdn.jsdelivr.net/gh/xyt250/image/img/image-20250626201333202.png)

将密码设置为题目中要求的 Key-1122

剩下的安装步骤直接下一步即可。最后点击安装

![image-20250626201834944](https://cdn.jsdelivr.net/gh/xyt250/image/img/image-20250626201834944.png)

安装时间很长，需要稍微等几分钟。

完成之后，打开服务器管理器工具中的DNS 进入DNS管理器界面 

打开反向查找区域 右键新建

![image-20250626204744965](https://cdn.jsdelivr.net/gh/xyt250/image/img/image-20250626204744965.png)

设置为主要区域 勾选至此域中的域控制器上运行的所有DNS服务器

输入网络为 10.10.10

![image-20250626204959037](https://cdn.jsdelivr.net/gh/xyt250/image/img/image-20250626204959037.png)

最后勾选只允许安全的动态更新（适合Active Directory 使用）

此时打开域的DNS正向解析中会发现有windows1

![image-20250626205245660](https://cdn.jsdelivr.net/gh/xyt250/image/img/image-20250626205245660.png)

但是我们刚创建好的DNS反向查找区域中并没有，此时我们先在正向区域中随便创建一个符合条件的主机用来测试，这里我随便填写一个![image-20250626205439674](https://cdn.jsdelivr.net/gh/xyt250/image/img/image-20250626205439674.png)

然后我们点击添加主机，出现如图所示代表DNS反向查找区域正确

![image-20250626205542173](https://cdn.jsdelivr.net/gh/xyt250/image/img/image-20250626205542173.png)

查看正反向查找区域都存在之后，我们将刚才创建的主机删除。

现在我们回归正题 ， 把正向查找区域中的windows1给删除掉 接下来重新创建主机windows1

此时打开反向查找区域后可以看到windows1的存在

![image-20250626210145015](https://cdn.jsdelivr.net/gh/xyt250/image/img/image-20250626210145015.png)

创建完成之后切换到windows2



根据上面的同样的操作 将windows2的IP地址也设置为静态IP地址 将DNS指向为windows1

![image-20250626203845550](https://cdn.jsdelivr.net/gh/xyt250/image/img/image-20250626203845550.png)

和上面的操作一样打开设置找到

关于 拉到最下面 找到 系统保护 点击系统保护 进入后点击 更改 输入计算机名 windows2 

输入域名 skills.cn  对话框出现以后输入用户名 和刚刚设置的密码 

用户名为： administrator 密码为：Key-1122 

出现如下提示代表加入域成功反正为错误。

![image-20250626204505621](https://cdn.jsdelivr.net/gh/xyt250/image/img/image-20250626204505621.png)

此时我们在回到windows1中查看反向查找区域会发现反向查找区域中也出现了windows2这样就代表成功加入域并且有DNS记录了这一步操作就完成了。（如果没有出现可能是因为没有打开动态更新可以打开后刷新试试）

接下来我们再次回到windows2中打开服务器管理器界面

再次点击添加角色和功能 选择AD域进行安装

![image-20250627083440937](https://cdn.jsdelivr.net/gh/xyt250/image/img/image-20250627083440937.png)



安装完成之后选择将此服务器提升为域控制器

![image-20250627084136860](https://cdn.jsdelivr.net/gh/xyt250/image/img/image-20250627084136860.png)



勾选将域控制器添加到现有域 

然后点击下面的更改填入用户名和密码进行下一步。

进入域控制器选项，再次输入用户名和密码进行下一步。

安装完成之后，再次打开服务器管理器找到DNS管理器，打开 DNS 管理器，查看是否从主域控制器复制了 “[skills.cn](https://skills.cn/)” 正反向区域记录。

![image-20250627085528223](https://cdn.jsdelivr.net/gh/xyt250/image/img/image-20250627085528223.png)

由于windows4 和 windows5 的IP地址和前三台主机不同网段，所以需要新添加反向查找区域。我这里把20段和50段都添加了。

检查完成之后，按照上面的操作，把刚才剩下的三台主机都加入域中。

首先要将所有主机IP地址都改为静态，然后再修改主机名并加入域。（必须保证IP是静态，不然无法同步DNS记录）

添加完成之后查看正反向查找区域是否有对应的主机。

![image-20250627093925899](https://cdn.jsdelivr.net/gh/xyt250/image/img/image-20250627093925899.png)

![image-20250627093939619](https://cdn.jsdelivr.net/gh/xyt250/image/img/image-20250627093939619.png)

这样我们就把所有的主机都添加进来了。



### 3、颁发证书

我们现在打开windows1主机，

打开服务器管理器 

选择 Active Directory 证书服务 进行安装，安装完成后 点击中间的 配置目标服务器上的 Active Directory 证书服务

然后勾选证书颁发机构 ，企业CA ，根CA ， 创建新的私钥，CA名称中填写此处CA的公用名称 题目中要求的是 windows1.skills.cn    有效期设置为20年

在工具中找到证书颁发机构，然后点击证书模板

 ![image-20250627111316164](https://cdn.jsdelivr.net/gh/xyt250/image/img/image-20250627111316164.png)

右建证书模板点击管理

![image-20250627111443129](https://cdn.jsdelivr.net/gh/xyt250/image/img/image-20250627111443129.png)



选择计算机模板点击复制 名称为计算机副本。

在“新模版的属性” 中的 “常规” 选项卡中 输入模版显示名称 为默认,设置 颁发证书有效期为10年。勾选在 Active Directory 中发布证书，将用户权限都给好完全控制。添加everyone 设置为完全控制。



![image-20250627112405838](https://cdn.jsdelivr.net/gh/xyt250/image/img/image-20250627112405838.png)

![image-20250627112446605](https://cdn.jsdelivr.net/gh/xyt250/image/img/image-20250627112446605.png)



请求处理 中勾选允许导出私钥。

![image-20250627112518978](https://cdn.jsdelivr.net/gh/xyt250/image/img/image-20250627112518978.png)





在“使用者名称”选项卡中选择“在请求中提供”。在“扩展” 选项卡中，确保“应用程序策略” 包含 “服务器身份验证” ，点击“编辑” 添加。 关闭 “证书模版控制台”。



![image-20250627113623586](https://cdn.jsdelivr.net/gh/xyt250/image/img/image-20250627113623586.png)

![image-20250627113713165](https://cdn.jsdelivr.net/gh/xyt250/image/img/image-20250627113713165.png)

应用之后确定保存配置。

接下来回到证书颁发机构，点击证书模板，右键点击新建，新建要颁发的证书模板。从中找到我们刚刚创建的计算机副本，添加到证书模板中

![image-20250627114001583](https://cdn.jsdelivr.net/gh/xyt250/image/img/image-20250627114001583.png)

win + R 打开运行窗口 输入regedit

打开注册表编辑器 按照路径依次点开找到我们的证书

![image-20250627114540226](https://cdn.jsdelivr.net/gh/xyt250/image/img/image-20250627114540226.png)



修改倒数第三个数值数据为 10， 因为证书的有效期要的是十年 。

在运行中输入“mmc"打开控制台，展开”文件"选项卡 点击”添加/删除管理单元“ 找到“证书” 添加

![image-20250627115119752](https://cdn.jsdelivr.net/gh/xyt250/image/img/image-20250627115119752.png)



展开“证书（本地计算机）”目录，选择“个人” “证书”，右键“证书” ，选择“所有任务”  “申请新证书”。

证书模板选择我们刚刚创建的 计算机副本

![image-20250627115225974](https://cdn.jsdelivr.net/gh/xyt250/image/img/image-20250627115225974.png)

然后点击配置详细信息依次设置  公用名=skills.cn，国家=CN，省=XX，

城市=XX，组织=skills，组织单位=system，使用者可选名称 =*.skills.cn 和 skills.cn

![image-20250627115954759](https://cdn.jsdelivr.net/gh/xyt250/image/img/image-20250627115954759.png)

申请完成之后查看证书是否申请成功查看日期是否正确

![image-20250627141247459](https://cdn.jsdelivr.net/gh/xyt250/image/img/image-20250627141247459.png)

### 4、测试

证书申请完成后 随便创建一个新建文件夹然后创建一个文本文档写点内容 将后缀改为html, 在 ISS管理器当中创建一个网站比如网站名称为www.skills.cn 物理路径为刚才创建的文件路径 主机名称填写www.skills.cn 绑定类型设置为https  IP地址设置为本机地址 然后再DNS中添加一个名为 www 的主机IP地址为本机地址，将证书绑定到网站中 可以看到访问时候是没有出现不安全

最后需要测试访问 在客户端计算机上，打开浏览器，输入https://www.skills.cn ( 假设已将域名解析到服务器 IP），如果证书配置正确且信任关系建立成功，浏览器不应提示不安全。如果仍然提示不安全，可能需要检查证书链是否完整、客户端时间是否正确等因素。刷新不成功 ，可以直接重新输入网址。（测试完成之后将有关的东西都删除掉即可）

下面是正确的显示



![image-20250627144839904](https://cdn.jsdelivr.net/gh/xyt250/image/img/image-20250627144839904.png)

### 5、申请从属证书

打开windows2主机

在服务器管理器中 开始安装证书服务。

安装完成后，配置目标服务器上的 AD 证书服务

角色服务勾选证书颁发机构   设置类型默认企业	CA类型为从属CA 其他默认

CA公用名称输入题目中要求的 windows2.skills.cn

![image-20250627150146987](https://cdn.jsdelivr.net/gh/xyt250/image/img/image-20250627150146987.png)



**提供父 CA 证书**：此时需要提供父 CA（如 Windows 1 上的根 CA）的证书，按照提示操作，确保 Windows 2 能够获取到正确的父 CA 证书信息，点击 “下一步

![image-20250627150442865](https://cdn.jsdelivr.net/gh/xyt250/image/img/image-20250627150442865.png)

查看windows2中的证书

![image-20250627150802595](https://cdn.jsdelivr.net/gh/xyt250/image/img/image-20250627150802595.png)



在服务器管理器中 工具找到 A D 用户和计算机 右键skills.cn 选择新建 组织单元 创建完成一次之后需要再次点击skills.cn （不然就会把组织单元创建到你刚刚创建的下面了我们需要创建到域中）然后依次输入 需要创建组织单元的名称，ADMIN、HR、IT 的 3 个组织单元 （记得不勾选防止容器被意外删除）

![image-20250627153140545](https://cdn.jsdelivr.net/gh/xyt250/image/img/image-20250627153140545.png)

创建完成之后右键选择新建 组  输入创建组的名称 勾选 全局 、 安全组。 

![image-20250627153330642](https://cdn.jsdelivr.net/gh/xyt250/image/img/image-20250627153330642.png)

win +R 输入 gpmc.msc 打开组策略管理器 依次点击 林 、域、skills.cn、组策略对象

![image-20250627154800874](https://cdn.jsdelivr.net/gh/xyt250/image/img/image-20250627154800874.png)

###  应用范围

- **Default Domain Policy**
  - **作用对象**：整个域内的所有用户和计算机（包括域控制器）。
  - **优先级**：低于组织单元 (OU) 中应用的策略，但高于域控制器策略。
- **Default Domain Controllers Policy**
  - **作用对象**：仅应用于域控制器计算机账户（存储在`Domain Controllers` OU 中）。
  - **优先级**：优先级最高，会覆盖其他策略（包括域策略）对域控制器的设置。

| **配置项**       | **Default Domain Policy**        | **Default Domain Controllers Policy**        |
| ---------------- | -------------------------------- | -------------------------------------------- |
| **密码策略**     | 定义域密码复杂度、最小长度等规则 | 不包含密码策略（由域策略统一管理）           |
| **账户锁定策略** | 定义账户锁定阈值和时间           | 不包含账户锁定策略（由域策略统一管理）       |
| **审计策略**     | 基础审计设置                     | 强化审计（如详细记录登录尝试、账户管理）     |
| **网络安全**     | 标准网络安全设置                 | 更严格的网络安全（如禁用不必要的端口）       |
| **用户权限分配** | 普通用户权限                     | 严格限制对 DC 的访问权限（如仅管理员可登录） |



这里我们需要定义账户密码的规则我们应该选  **Default Domain Policy**

右键编辑

计算机配置 → 策略 → Windows设置 → 安全设置 → 账户策略 → 密码策略

1. 将 “密码必须符合复杂性要求” 由 “已启用” 改为 “已禁用”。
2. 根据需求调整 “密码长度最小值”，若无需限制，可将其改为 “0” 个字符。

![image-20250627160340219](https://cdn.jsdelivr.net/gh/xyt250/image/img/image-20250627160340219.png)



#### **在 ADMIN OU 中创建 30 个用户并加入 ADMIN 组**

1. **批量创建用户**
   - 右键点击 **ADMIN** OU → **新建** → **用户**，手动输入用户名（如 `ADMIN1`）、密码（与用户名相同），并取消勾选 **用户必须在下次登录时更改密码**，勾选 **用户不能更改密码** 和 **密码永不过期**1013。
   - 重复此步骤创建 `ADMIN1` 至 `ADMIN30`。
2. **将用户加入 ADMIN 组**
   - 打开 `ADMIN` 组属性 → **成员** 选项卡 → **添加** → 输入 `ADMIN*` 搜索所有 ADMIN 用户 → **确定**

其他组也按照上面的操作依次创建用户。

![image-20250627153901564](https://cdn.jsdelivr.net/gh/xyt250/image/img/image-20250627153901564.png)

创建好用户以后右键用户 选择添加到组 搜索该用户组 点击添加 添加完成后可以在组中查看

![image-20250627160707214](https://cdn.jsdelivr.net/gh/xyt250/image/img/image-20250627160707214.png)



**打开管理工具**

点击 **开始菜单** → **管理工具** → **Active Directory 用户和计算机**

**定位 Domain Admins 组**

![image-20250627162630452](https://cdn.jsdelivr.net/gh/xyt250/image/img/image-20250627162630452.png)

右键属性 选择成员 点击添加 查找用户 ADMIN10 将该用户添加到组中。

![image-20250627162730638](https://cdn.jsdelivr.net/gh/xyt250/image/img/image-20250627162730638.png)



## 3、组策略

win +R 输入 gpmc.msc 打开组策略管理器 依次点击 林 、域、skills.cn、组策略对象

![image-20250627154800874](https://cdn.jsdelivr.net/gh/xyt250/image/img/image-20250627154800874.png)

**以下是通过组策略实现各项任务的详细步骤，推荐创建自定义 GPO 而非直接修改默认 GPO：**

### 1、**禁止域用户登录时自动显示服务器管理器**

1. **创建自定义 GPO**
   - 打开 **组策略管理控制台（GPMC）**
   - 右键点击域名 → **创建 GPO 并在此处链接**
   - 命名为 **"禁用服务器管理器自动启动"**
2. **配置策略**
   - 编辑 GPO → 导航至：
     `计算机配置 → 策略 → 管理模板 → 系统 → 服务器管理器`
   - 启用 **"登录时不自动启动服务器管理器"**
   - ![image-20250627190733273](https://cdn.jsdelivr.net/gh/xyt250/image/img/image-20250627190733273.png)

### 2、**自动申请 IPsec 和工作站身份验证证书**

#### **配置证书模板**

1. 打开 **证书颁发机构（CertSrv）** 控制台

2. 右键 `证书模板` → `管理`

   - **IPSec 模板**：
     - 复制 `IPSec` 模板 → 命名新模板（如 `IPSec-AutoEnroll`）
     - 在 `安全` 选项卡添加 `Domain Computers` 组 → 勾选 **自动注册**

   ![image-20250627193411113](https://cdn.jsdelivr.net/gh/xyt250/image/img/image-20250627193411113.png)

   

   - **工作站身份验证模板**：
     - 复制 `工作站身份验证` 模板 → 命名新模板（如 `Workstation-Auth`）
     - 在 `扩展` 选项卡 → 添加 **服务器身份验证** (OID: `1.3.6.1.5.5.7.3.1`)
     - 在 `常规` 选项卡 → **有效期设为 10 年**
     - 在 `安全` 选项卡添加 `Domain Computers` → 勾选 **自动注册**

![image-20250627193431803](https://cdn.jsdelivr.net/gh/xyt250/image/img/image-20250627193431803.png)

#### **配置组策略（GPO）**

1. 编辑 **默认域策略** 或新建 GPO
2. 导航至：
   `计算机配置` → `策略` → `Windows 设置` → `安全设置` → `公钥策略`
   - 启用 **证书服务客户端 - 自动注册**
     - 勾选 `续订过期证书` 和 `更新使用证书模板的证书`

![image-20250627192712792](https://cdn.jsdelivr.net/gh/xyt250/image/img/image-20250627192712792.png)

### **3、域控制器登录权限控制**

#### **通过组策略配置（GPO）**

1. 编辑 **域控制器 OU 的 GPO**

2. 配置本地登录权限：
   `计算机配置` → `策略` → `Windows 设置` → `安全设置` → `本地策略` → `用户权限分配`

   - **允许本地登录** → 添加 `ADMIN` 组

     

   - ![](https://cdn.jsdelivr.net/gh/xyt250/image/img/image-20250627193910805.png)

   - **通过远程桌面服务允许登录** → 添加 `ADMIN10` 用户![image-20250627194606342](https://cdn.jsdelivr.net/gh/xyt250/image/img/image-20250627194606342.png)



3. 配置网络访问限制：
   `拒绝从网络访问这台计算机` → 添加 `HR` 组

> **注意**：权限优先级：拒绝 > 允许。确保 `HR` 组未被其他策略允许访问。

![image-20250627194757739](https://cdn.jsdelivr.net/gh/xyt250/image/img/image-20250627194757739.png)

### 4、**彻底禁用计算器（calc.exe）**

#### **方案 1：使用 AppLocker（推荐）**

1. 启用 AppLocker：
   `计算机配置` → `策略` → `Windows 设置` → `安全设置` → `应用程序控制策略` → `AppLocker`
2. 创建 **哈希规则**：
   - 右键 `可执行规则` → `创建新规则`
   - 操作：**拒绝** → 用户：`Everyone`
   - 条件：`哈希` → 选择 `calc.exe`（任意路径下的副本）
   - 生成哈希值并完成规则
3. 强制生效：
   - 启动 **Application Identity** 服务（设置为自动启动）

![image-20250627202726705](https://cdn.jsdelivr.net/gh/xyt250/image/img/image-20250627202726705.png)



## 4、远程桌面

**打开windows3**

### 1、安装 RDS 角色服务                                                                          

1.  打开 **服务器管理器**                                                                                                                                                
2. 点击 **"管理"** → **"添加角色和功能"**                                                
3. 在 **"选择安装类型"** 页面：                                                                    
   - 选择 **"远程桌面服务安装"**                                                             
   - 点击 **下一步**                                                                                 

在 **"选择部署类型"** 页面：

- 选择 **"标准部署"**
- 点击 **下一步**

在 **"选择部署方案"** 页面：

- 选择 **"基于会话的桌面部署"**
- 点击 **下一步**

在 **"指定 RD 连接代理服务器"** 页面：

- 添加当前服务器 `windows3.skills.cn`
- 点击 **下一步**

![image-20250629091944917](https://cdn.jsdelivr.net/gh/xyt250/image/img/image-20250629091944917.png)

在 **"指定 RD Web 访问服务器"** 页面：

- 添加当前服务器 `windows3.skills.cn`
- 点击 **下一步**

在 **"指定 RD 会话主机服务器"** 页面：

- 添加当前服务器 `windows3.skills.cn`
- 点击 **下一步**

点击部署

![image-20250629092044078](https://cdn.jsdelivr.net/gh/xyt250/image/img/image-20250629092044078.png)

### 2、从属证书服务器颁发证书

打开windows2

1. **打开 MMC 控制台**
   - 按 `Win + R` 输入 `mmc` → 回车
   - 点击 **文件** → **添加/删除管理单元**
2. **添加证书管理单元**
   - 左侧列表选择 **"证书"** → 点击 **"添加"**
   - 选择 **"计算机账户"** → 下一步
   - 选择 **"本地计算机"** → 完成
   - 点击 **"确定"** 保存

1. - 展开控制台树：**证书(本地计算机)** → **个人**
   - 右键 **"个人"** → **所有任务** → **申请新证书**
   - 点击 **"下一步"** 开始证书注册
2.  **选择证书模板**
   - 在 **"证书注册策略"** 页面点击 **"下一步"**
   - 在 **"请求证书"** 页面：
     - 勾选 **"Web 服务器"** 模板 (有服务器身份验证的证书模板即可)
     - 点击右上角 **"详细信息"** 链接
   - 点击 **"注册"**

**配置证书属性**

- 在 **"证书属性"** 窗口：
  - **友好名称**：输入 `Y3-CRT`
  - **主题名称**：
    - 类型：**公用名**
    - 值：`windows3.skills.cn`
  - **备用名称**：
    - 类型：**DNS**
    - 值：`windows3.skills.cn`
  - 点击 **"添加"** → **"确定"**
  - **完成证书申请**
    - 返回注册页面 → 点击 **"注册"**
    - 查看结果：**"证书安装成功"** 状态
    - 点击 **"完成"**
  - **验证证书**
    - 展开 **"个人"** → **"证书"**
    - 在右侧列表中找到 `Y3-CRT`
    - 双击证书查看详情：
      - **颁发者**：从属证书服务器名称
      - **有效期**：应显示正确日期范围
      - **证书路径**：应显示完整的信任链

![image-20250629094023230](https://cdn.jsdelivr.net/gh/xyt250/image/img/image-20250629094023230.png)

创建共享文件夹将证书共享到 windows3 主机中

### 3、创建会话合集

打开 windows3 主机

打开本地磁盘 打开C盘 创建一个 RDP 文件夹 在该目录下创建一个 UserProfiles 文件夹 (因为此文件是用于存储用户配置文件) 

1. 打开远程桌面服务管理器

​    打开 **服务器管理器**

​    左侧导航选择 **"远程桌面服务"** → **"集合"**

​    点击任务选择， 创建会话集合

​    右键 **"集合"** → **"创建会话集合"**

将名称设置为 `Tech-RDS `  (示例，可自定义)

用户组设置为IT用户组

下一步

指定用户配置文件磁盘 为我们刚才创建的文路径 C:\RDP\UserProfiles

创建会话合集

![image-20250629104901323](https://cdn.jsdelivr.net/gh/xyt250/image/img/image-20250629104901323.png)

点击创建的合集 点击  属性中的任务  编辑属性 

确保在远程访问时可以看到会话名称 和存储位置是否为C盘下的RDP文件中。

![image-20250629105606813](https://cdn.jsdelivr.net/gh/xyt250/image/img/image-20250629105606813.png)

打开客户端设置 只需要勾选 驱动器、打印机，共享剪贴板，其他的都不需要勾选。

打开负载平衡 将会话限制为 100  应用之后确定。

1. **（本地策略）**：

   - 按 `Win + R` 输入 `gpedit.msc` → 回车。

   - ```
     计算机配置
     → 管理模板
     → Windows 组件
     → 远程桌面服务
     → 远程桌面会话主机
     → 远程会话环境
     ```

![image-20250629195744670](https://cdn.jsdelivr.net/gh/xyt250/image/img/image-20250629195744670.png)

在远程会话环境中找到连时启动程序 然后点击启动 输入启用文件的路径 

C:\Program Files（x86）\Microsoft\Edge\Application\msedge.exe

![image-20250629202313725](https://cdn.jsdelivr.net/gh/xyt250/image/img/image-20250629202313725.png)

### 4、配置会话合集 导航到相关策略设置

- 在组策略编辑器中，依次展开：

  ```
  用户配置 -> 管理模板 -> 系统 -> 登录
  ```

找到在计算机登陆时运行这些程序。双击

- 选择 **已启用**
- 点击"显示" → 添加 `msedge.exe`
- 点击确定
- 应用 后确定



- ![image-20250630092955321](https://cdn.jsdelivr.net/gh/xyt250/image/img/image-20250630092955321.png)

打开 文件资源管理器 

导航到 Edge 的安装目录：

C:\Program Files（x86）\Microsoft\Edge\Application\msedge.exe

右键 msedge.exe → 属性 → 安全 选项卡

点击 高级 → 禁用继承 → 选择 "从此对象中删除所有已继承的权限"

点击 添加 → 选择主体 输入 技术组(IT) → 检查名称 → 确定 授予权限：读取和执行

点击 添加 → 选择主体 输入 技术组 → 检查名称 → 确定 授予权限：读取和执行 添加 SYSTEM 和 Administrators 组，授予 完全控制

![image-20250630102829463](https://cdn.jsdelivr.net/gh/xyt250/image/img/image-20250630102829463.png)

点击 确定 保存所有更改。

### 5、配置 RDS 会话合集 

转到 工具 → 远程桌面服务 → RD 会话主机管理器

1. 打开 **远程桌面服务管理器**
2. 选择会话集合 → **RemoteApp 程序** 选项卡
3. **发布 RemoteApp 程序**：
   - 添加程序 → 浏览到 `C:\Program Files (x86)\Microsoft\Edge\Application\msedge.exe`

### **6、验证 Web 访问**

1. 访问 URL：`https://windows3.skills.cn/rdweb`
2. 使用技术组成员账户登录
3. 验证功能：
   - ✅ 仅显示 MS Edge 应用图标
   - ✅ 启动后显示会话名称 "技术组远程会话"
   - ✅ 文件资源管理器可见客户端驱动器
   - ✅ 测试剪贴板复制粘贴功能
   - ✅ 检查打印机重定向









### 7、应用并验证配置











## 5、NLB 服务

**这里我们先配置配置NLB服务 后配置Web服务**

### 1、关闭端口安全

先打开云平台，找到主机 windows4 和 windows5

![image-20250630182746163](https://cdn.jsdelivr.net/gh/xyt250/image/img/image-20250630182746163.png)

点击编辑安全组

![image-20250630182945388](https://cdn.jsdelivr.net/gh/xyt250/image/img/image-20250630182945388.png)

将 端口安全 的勾选取消。 点击 更新即可完成修改 。把所有主机端口 端口安全都关闭。

**关闭两台主机中的防火墙**

进入“控制面板 > Windows Defender 防火墙 > 启用或关闭防火墙”，**暂时关闭**防火墙

因为这里的主机名所以我们需要在DNS服务中创建对应的主机。**新建主机 www IP地址为10.10.20.103**

###  2、先创建 NLB 群集（核心）

#### **在 Windows4 上操作**

打开windows4主机

安装 IIS 和 NLB 服务 （网络负载平衡）

1. 打开 **网络负载平衡管理器**
   （`nlbmgr` 或 开始菜单搜索）
2. 新建群集：
   - **群集 IP**：`10.10.20.103`
   - **子网掩码**：`255.255.255.0`
   - **完整 Internet 名称**：`www.skills.cn`
3. 添加首节点：
   - 主机 IP：`10.10.10.20.101`（Windows4 物理 IP）
   - 优先级：`4`

![image-20250630201758428](https://cdn.jsdelivr.net/gh/xyt250/image/img/image-20250630201758428.png)



#### **在 Windows5 上操作**

打开windows5主机

安装 IIS 和 NLB 服务 （网络负载平衡）

右键网络负载平衡群集  选择 连接到现存的。

1. 在 NLB 管理器中右键群集 → **添加主机**
2. 指定参数：
   - 主机 IP：`10.10.20.102`（Windows5 物理 IP）        

![image-20250630204219236](https://cdn.jsdelivr.net/gh/xyt250/image/img/image-20250630204219236.png)

确保两端都同步成功都有群集，且两台主机都是已聚合。此时NLB的配置服务完成。









### 3、创建共享文件夹

打开windows1 主机

创建 T 分区

- 打开 **磁盘管理** (`diskmgmt.msc`)
- 右键 C 盘 → **"压缩卷"** (2GB) → 创建 **新简单卷**
- 分配驱动器号 **T:** → 格式化为 **NTFS**

![image-20250630183524209](https://cdn.jsdelivr.net/gh/xyt250/image/img/image-20250630183524209.png)

创建完成后 在文件资源管理器中 打开 T盘 开始创建共享文件夹

先创建一个 WebShare文件

在创建 WWW (共享网页文件) 

 Configs （共享配置文件）

和 logs  （网站日志文件）

- 共享权限：Everyone → **完全控制**

![image-20250630184105558](https://cdn.jsdelivr.net/gh/xyt250/image/img/image-20250630184105558.png)

### 4、windows4配置 （主Web)服务器配置

**配置网站设置**

- 打开 **IIS 管理器** → 添加网站：

  - 名称: `www`
  - 物理路径: `\\windows1\WebShare\WWW`
  - 绑定: HTTPS
  - IP地址为 10.10.20.103
  - 主机名为www.skills,cn
  - 网站限制（高级设置）：

  | 项目           | 值                 |
  | :------------- | :----------------- |
  | 最大并发连接数 | 10000              |
  | 连接超时       | 00:01:00           |
  | 带宽限制       | 12500000 (100Mbps) |


![image-20250703093849106](https://cdn.jsdelivr.net/gh/xyt250/image/img/image-20250703093849106.png)

在网站页面右侧导航栏选择“限制”  “限制带宽使用(字节)” 为12500000  

1. 首先明确单位换算关系
   - 1 字节（Byte）= 8 位（bit）。
   - 1Mbps（兆比特每秒）表示每秒传输 1 兆（）比特。
2. 然后进行换算
   - 100Mbps 即每秒传输比特。
   - 要换算成字节每秒，因为 1 字节等于 8 比特，所以将比特数除以 8。
   - 计算可得：字节每秒，即 12500000 字节每秒。

所以 100Mbps 等于 12500000 字节每秒，这个速度常用于衡量网络带宽，表示每秒最多可以传输 12500000 字节的数据。![image-20250630191519408](https://cdn.jsdelivr.net/gh/xyt250/image/img/image-20250630191519408.png)

1. **配置W3C日志**：
   - 双击"日志" → 格式：`W3C`
   - 选择字段：仅勾选`日期`、`时间`、`客户端IP地址`、`用户名`、`客户端端口`
   - 日志文件目录：`\\Windows1\T$\WebShare\Logs`
   - 滚动更新：`每小时`
   - ![image-20250703143018359](https://cdn.jsdelivr.net/gh/xyt250/image/img/image-20250703143018359.png)
   - 应用

- 在`\\Windows1\T$\WebShare\WWW`新建`index.asp`，内容：







### 5、证书颁发 共享配置（Windows4 → Windows5）

在windows1中

1. **配置证书 (Y4-CRT)**

   - 从 CA 申请证书：
     - 证书模板: **计算机副本**
     - 友好名称: `Y4-CRT`
   - IIS 绑定: HTTPS → 选择证书

   ![image-20250630193742537](https://cdn.jsdelivr.net/gh/xyt250/image/img/image-20250630193742537.png)

   申请完成后将证书共享到 windows4 中

   **windows5证书申请**：
   
   - 重复上述步骤 → 证书模板：`计算机副本` → 友好名称：`Y5-CRT
   - ![image-20250703152211060](https://cdn.jsdelivr.net/gh/xyt250/image/img/image-20250703152211060.png)
   
   1. **启用共享配置**（Windows4）：
      - IIS管理器 → 选择服务器节点 → 共享配置
      - IIS管理器界面，IIS有两个分组，一个IIS分组，一个管理分组，而共享配置文件就在管理分组下名称为**（Shared Configuration）**  他的意思就是共享文件。
      - 双击打开 共享文件 ，然后打开后再次双击文件右侧的蓝色字体。（蓝色字体的意思是导出配置）
      - ![image-20250703194736495](https://cdn.jsdelivr.net/gh/xyt250/image/img/image-20250703194736495.png)
        - 勾选"启用共享配置"
        - 物理路径：`\\Windows1\T$\WebShare\Configs`
        - 设置加密密钥密码 → 导出密钥
        - 依次输入文件路径 ，加密密钥密码和确认密码，弹出图中的提示后代表成功导出配置。
        - ![image-20250703194959770](https://cdn.jsdelivr.net/gh/xyt250/image/img/image-20250703194959770.png)
        - 
   2. **应用共享配置**（Windows5）：
      - IIS管理器 → 共享配置 → 启用共享配置
        - 配置位置：`\\Windows1\T$\WebShare\Configs`
        - 输入密钥密码 → 应用
        - 会弹出我们刚才设置的加密密钥密码，我们输入后将会完成应用
        - ![image-20250703195252340](https://cdn.jsdelivr.net/gh/xyt250/image/img/image-20250703195252340.png)
   
   根据图中提示表示更改了我们的配置，我们需要重启IIS管理器来使配置生效。
   
   1. **在 Windows5 上启用共享配置**：
      - 打开 IIS 管理器，选择服务器节点，双击“共享配置”图标。
      - 勾选“启用共享配置”，输入正确的共享路径和密码，点击“应用”。
   2. **验证配置文件的正确性和完整性**：
      - 在 Windows5 上，检查 IIS 配置是否与 Windows4 一致。若有不一致，可能是路径错误或文件损坏，需重新导出和导入配置。
   3. **重启 IIS 服务**：
      - 在 Windows5 上，重启 IIS 服务以使新配置生效。

### ![image-20250703200843315](https://cdn.jsdelivr.net/gh/xyt250/image/img/image-20250703200843315.png)

绑定证书为Y5-CRT

![image-20250703200953510](https://cdn.jsdelivr.net/gh/xyt250/image/img/image-20250703200953510.png)



接下来打开windows1主机，然后在服务器管理器中 点击工具中的证书颁发机构，在证书颁发机构中配置管理员证书模板。



## 6、创建Windows Server 2022虚拟机，虚拟机信息如下：

按要求创建windows6和windows7

































































